/**
 * Infinite Marquee 1.0.8
 * Infinite Horizontal & Vertical Marquee animation based on CSS and controlled with JS
 *
 * Copyright 2024 Vahan Baghdasaryan
 *
 * Released under the MIT License
 *
 * Released on: February 2, 2024
 */

export default class e{constructor(e={}){this.element="string"==typeof e.element?[...document.querySelectorAll(e.element)]:e.element,this.direction=e.direction||"left",this.spaceBetween=e.spaceBetween||"0px",this.gap={vertical:e.gap&&e.gap.vertical||"5px",horizontal:e.gap&&e.gap.horizontal||"0px"},this.speed=e.speed||1e4,this.fullContainer=e.fullContainer||!1,this.smoothEdges=e.smoothEdges||!1,this.pauseOnHover=e.pauseOnHover||!1,this.duplicateCount=e.duplicateCount||1,this.breakpointSize=e.breakpointSize||991.8,this.desktopBreakpoint=this.breakpointSize+.2,this.mobileSettings=e.mobileSettings||{},this.destroyOnDesktop=e.destroyOnDesktop||!1,this.destroyOnMobile=e.destroyOnMobile||!1,this.elementClass=e.elementClass||"marquee-container",this.on={beforeInit:e.on&&e.on.beforeInit||null,afterInit:e.on&&e.on.afterInit||null,pauseAnimation:e.on&&e.on.pauseAnimation||null,resumeAnimation:e.on&&e.on.resumeAnimation||null},this.scrollType="top"===e.direction||"bottom"===e.direction?"vertical":"horizontal",this.debug=e.debug||!1,this.isPaused=!1,this.isMarqueeInitialized=!1,this.isMarqueeInitialized||this.init(),"undefined"!=typeof window&&(this.destroyOnResponsive(),(this.destroyOnMobile||this.destroyOnDesktop)&&window.addEventListener("resize",this.destroyOnResponsive.bind(this)))}init(){if(("undefined"!=typeof window||"undefined"!=typeof document)&&(Array.isArray(this.element)?this.element.length>0:this.element)){if(this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Initialized"),window.matchMedia("(prefers-reduced-motion: reduce)").matches){this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Motion is Reduced");return}if(this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Motion Not Reduced"),"function"==typeof this.on.beforeInit&&this.on.beforeInit(),Array.isArray(this.element)){for(let e of(this.isMarqueeInitialized=!0,this.element))this.configureChildNodes(e),this.configureAnimationOptions(e);this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - DOM Nodes Created from Array")}else this.isMarqueeInitialized=!0,this.configureChildNodes(this.element),this.configureAnimationOptions(this.element),this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - DOM Nodes Created from Single Element");"function"==typeof this.on.afterInit&&this.on.afterInit()}else this.debug&&console.error("\uD83D\uDE8A Infinite Marquee - Failed to Initialize")}configureChildNodes(e){let t=document.createElement("div");for(t.classList.add(`${this.scrollType}-marquee-inner`);e.firstChild;)t.appendChild(e.firstChild);e.classList.add(`${this.scrollType}-marquee`),e.appendChild(t),this.duplicateOriginalNodes(t),this.duplicateContainer(e),this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - DOM Nodes Appended Successfully")}duplicateOriginalNodes(e){let t=e.children,i=[];for(let s=0;s<t.length;s++){let n=t[s],o=n.cloneNode(!0);o.setAttribute("aria-hidden",!0),i.push(o)}for(let r of i)e.appendChild(r);this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - DOM Nodes Duplicated Successfully")}duplicateContainer(e){let t=e.querySelector(`.${this.scrollType}-marquee-inner`),i=t.cloneNode(!0);i.setAttribute("aria-hidden",!0);let s=i.children;for(let n=0;n<s.length;n++)s[n].removeAttribute("aria-hidden");let o="vertical"===this.scrollType?this.duplicateCount+1:this.duplicateCount,r=Array.from({length:o},()=>i.cloneNode(!0));if(e.append(...r),"vertical"===this.scrollType){let l=e.clientHeight-t.clientHeight;e.style.setProperty("--_containerSize",`${l}px`)}}configureAnimationOptions(e){let t=window.matchMedia(`(max-width: ${this.breakpointSize}px)`),i=e=>{e.addEventListener("mouseenter",()=>this.pause(e)),e.addEventListener("mouseleave",()=>this.resume(e))},s=()=>{if(this.isMarqueeInitialized){let s=this.mobileSettings.direction||this.direction,n="right"===this.direction||"bottom"===this.direction,o=t.matches?"right"===s||"bottom"===s?"reverse":"forwards":n?"reverse":"forwards",r=t.matches&&this.mobileSettings.speed||this.speed;if(e.style.setProperty("--_speed",`${r}ms`),e.style.setProperty("--_direction",o),this.smoothEdges&&e.classList.add("smooth"),"vertical"===this.scrollType){let l=t.matches&&this.mobileSettings&&this.mobileSettings.gap&&this.mobileSettings.gap.horizontal||this.gap.horizontal,a=t.matches&&this.mobileSettings&&this.mobileSettings.gap&&this.mobileSettings.gap.vertical||this.gap.vertical;this.gap.horizontal&&e.style.setProperty("--_hGap",l),this.gap.vertical&&e.style.setProperty("--_vGap",a)}else{let h=t.matches&&this.mobileSettings.spaceBetween||this.spaceBetween;e.style.setProperty("--_gap",h),this.fullContainer&&e.classList.add("full")}window.innerWidth>=this.desktopBreakpoint&&this.pauseOnHover&&i(e),this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Animation Configs Ready")}};s(),window.addEventListener("resize",this.debounce(s))}destroyOnResponsive(){let e=`${this.scrollType}-marquee-inner`,t=this.element;"undefined"==typeof window||(window.innerWidth<=this.breakpointSize&&this.destroyOnMobile?this.manageMarquee(t,e):window.innerWidth>=this.desktopBreakpoint&&this.destroyOnDesktop?this.manageMarquee(t,e):this.isMarqueeInitialized||(this.init(),this.isMarqueeInitialized=!0))}manageMarquee(e,t){this.isMarqueeInitialized&&(this.destroy(e,t),this.isMarqueeInitialized=!1,this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Destroyed Successfully"))}removeClassesAfter(e,t){if(t&&t.classList){let i=!1;for(let s=0;s<t.classList.length;s++){let n=t.classList[s];i&&(t.classList.remove(n),s--),n===e&&(i=!0)}}}destroy(e,t){if(e){e.removeAttribute("style");let i=e.querySelectorAll(`.${t}`);for(let s=1;s<i.length;s++)e.removeChild(i[s]);let n=e.firstElementChild;if(n){let o=n.querySelectorAll('[aria-hidden="true"]');if(o.forEach(function(e){n.removeChild(e)}),n.classList.contains(t)){for(;n.firstChild;)e.appendChild(n.firstChild);e.removeChild(n),this.removeClassesAfter(this.elementClass,e)}}}}pause(e){let t=e||this.element;t.classList.add("paused"),this.isPaused=!0,this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Animation Paused"),"function"==typeof this.on.pauseAnimation&&this.on.pauseAnimation()}resume(e){let t=e||this.element;t.classList.remove("paused"),this.isPaused=!1,this.debug&&console.log("\uD83D\uDE8A Infinite Marquee - Animation Resumed"),"function"==typeof this.on.resumeAnimation&&this.on.resumeAnimation()}debounce(e,t=300){let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout(()=>{e(...s)},t)}}};
